{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h4 class="mb-4">üì® Rozmowa z <strong>{{ contact_user.username }}</strong></h4>
  <p><small>Og≈Çoszenie: <a href="{% url 'ad_detail' ad.id %}">{{ ad.title }}</a></small></p>

  <div id="chat-box" class="border rounded p-3 mb-3 bg-white shadow-sm" style="max-height: 400px; overflow-y: auto;">
    {% for msg in chat_messages %}
      <div class="mb-3 {% if msg.sender == request.user %}text-end{% endif %}">
        <div class="d-inline-block p-2 px-3 rounded-pill {% if msg.sender == request.user %}bg-primary text-white{% else %}bg-light border{% endif %}">
          {{ msg.text }}
        </div><br>
        <small class="text-muted {% if msg.sender == request.user %}me-2{% else %}ms-2{% endif %}">
          {{ msg.created_at|date:"Y-m-d H:i" }}
        </small>
      </div>
    {% empty %}
      <p class="text-muted">Brak wiadomo≈õci w tej rozmowie.</p>
    {% endfor %}
  </div>

  <form method="post" autocomplete="off">
    {% csrf_token %}
    <div class="input-group">
      <input type="text" name="text" class="form-control" placeholder="Napisz wiadomo≈õƒá..." required>
      <button class="btn btn-primary">Wy≈õlij</button>
    </div>
  </form>
</div>

<script>
  // Auto scroll to bottom
  const chatBox = document.getElementById('chat-box');
  chatBox.scrollTop = chatBox.scrollHeight;
</script>
{% endblock %}
